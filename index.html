<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Pronunciation Practice</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 800px;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
        }
        
        p {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .settings-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .settings-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .settings-toggle h3 {
            color: #555;
            font-size: 1.1rem;
        }
        
        .settings-content {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        
        .options-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .option-group {
            flex: 1;
            min-width: 200px;
        }
        
        .option-group h4 {
            margin-bottom: 10px;
            color: #555;
            font-size: 0.9rem;
            text-align: left;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-start;
        }
        
        .option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .option input {
            accent-color: #6e8efb;
        }
        
        .option label {
            color: #555;
            font-size: 0.9rem;
        }
        
        .custom-input {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f2f5;
            border-radius: 12px;
        }
        
        .custom-input h4 {
            margin-bottom: 10px;
            color: #555;
            text-align: left;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .input-group input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .input-group button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .input-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .custom-list {
            max-height: 150px;
            overflow-y: auto;
            text-align: left;
            background: white;
            border-radius: 8px;
            padding: 10px;
            border: 1px solid #eee;
        }
        
        .custom-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .custom-item:last-child {
            border-bottom: none;
        }
        
        .custom-item button {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .text-display {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            line-height: 1.5;
            color: #333;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .text-display::before {
            content: '"';
            font-size: 60px;
            position: absolute;
            left: 15px;
            top: 10px;
            color: #e0e0e0;
            font-family: serif;
        }
        
        .accuracy {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .accuracy-value {
            font-size: 32px;
            transition: all 0.3s ease;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #start-btn {
            background: linear-gradient(135deg, #4CAF50, #2E8B57);
            color: white;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }
        
        #record-btn {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
            color: white;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
            display: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            justify-content: center;
            padding: 0;
        }
        
        #record-btn.recording {
            background: linear-gradient(135deg, #f44336, #B71C1C);
            animation: pulse 1.5s infinite;
        }
        
        #speak-btn {
            background: linear-gradient(135deg, #9C27B0, #673AB7);
            color: white;
            box-shadow: 0 4px 10px rgba(156, 39, 176, 0.3);
            display: none;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            background-color: #f8f9fa;
            display: none;
            text-align: left;
            line-height: 1.8;
        }
        
        .correct {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .incorrect {
            color: #f44336;
            font-weight: bold;
        }
        
        .partial {
            color: #FF9800;
            font-weight: bold;
        }
        
        .status {
            margin-top: 20px;
            font-style: italic;
            color: #666;
            min-height: 24px;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(244, 67, 54, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(244, 67, 54, 0);
            }
        }
        
        .mic-icon {
            font-size: 24px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .options-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            button {
                padding: 12px 25px;
            }
            
            .text-display {
                font-size: 20px;
                padding: 20px 20px 20px 40px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>English Pronunciation Practice</h1>
        <p>Select your level and practice type, then click "Start" to begin. Record your pronunciation and get instant feedback!</p>
        
        <div class="settings-panel">
            <div class="settings-toggle">
                <h3>Practice Settings</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="settings-content">
                <div class="options-row">
                    <div class="option-group">
                        <h4>Difficulty Level</h4>
                        <div class="options">
                            <div class="option">
                                <input type="radio" id="beginner" name="level" value="beginner" checked>
                                <label for="beginner">Beginner</label>
                            </div>
                            <div class="option">
                                <input type="radio" id="intermediate" name="level" value="intermediate">
                                <label for="intermediate">Intermediate</label>
                            </div>
                            <div class="option">
                                <input type="radio" id="advanced" name="level" value="advanced">
                                <label for="advanced">Advanced</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <h4>Practice Type</h4>
                        <div class="options">
                            <div class="option">
                                <input type="radio" id="single-word" name="type" value="word" checked>
                                <label for="single-word">Single Words</label>
                            </div>
                            <div class="option">
                                <input type="radio" id="sentences" name="type" value="sentence">
                                <label for="sentences">Sentences</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="custom-input">
                    <h4>Add Your Own Words/Sentences</h4>
                    <div class="input-group">
                        <input type="text" id="custom-input" placeholder="Enter your word or sentence">
                        <button id="add-custom-btn">Add</button>
                    </div>
                    <div class="custom-list" id="custom-list">
                        <p>No custom items added yet</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="accuracy">
            <i class="fas fa-chart-line"></i>
            Accuracy: <span id="accuracy-value" class="accuracy-value">0%</span>
        </div>
        
        <div class="text-display" id="text-display">
            Click the Start button to begin...
        </div>
        
        <div class="buttons">
            <button id="start-btn">
                <i class="fas fa-play"></i>Start
            </button>
            <button id="record-btn">
                <i class="fas fa-microphone mic-icon"></i>
            </button>
            <button id="speak-btn">
                <i class="fas fa-volume-up"></i>Hear Pronunciation
            </button>
        </div>
        
        <div class="result" id="result"></div>
        <div class="status" id="status">Press Start to begin</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startBtn = document.getElementById('start-btn');
            const recordBtn = document.getElementById('record-btn');
            const speakBtn = document.getElementById('speak-btn');
            const textDisplay = document.getElementById('text-display');
            const resultDiv = document.getElementById('result');
            const accuracyValue = document.getElementById('accuracy-value');
            const statusEl = document.getElementById('status');
            const settingsToggle = document.querySelector('.settings-toggle');
            const settingsContent = document.querySelector('.settings-content');
            const customInput = document.getElementById('custom-input');
            const addCustomBtn = document.getElementById('add-custom-btn');
            const customList = document.getElementById('custom-list');
            
            // Get radio buttons
            const levelRadios = document.querySelectorAll('input[name="level"]');
            const typeRadios = document.querySelectorAll('input[name="type"]');
            
            let recognition;
            let currentText = '';
            let isRecording = false;
            let processingTimeout;
            
            // Word and sentence banks by difficulty
            const wordBanks = {
                beginner: [
                    "hello", "world", "apple", "house", "water",
                    "computer", "book", "teacher", "student", "friend",
                    "family", "music", "school", "color", "food"
                ],
                intermediate: [
                    "environment", "pronunciation", "technology", "information", "communication",
                    "development", "education", "government", "international", "organization",
                    "opportunity", "experience", "relationship", "professional", "temperature"
                ],
                advanced: [
                    "onomatopoeia", "idiosyncrasy", "paradigm", "epitome", "quintessential",
                    "ambiguous", "ubiquitous", "vociferous", "supercilious", "magnanimous",
                    "obfuscate", "pernicious", "serendipity", "antidisestablishmentarianism", "floccinaucinihilipilification"
                ]
            };
            
            const sentenceBanks = {
                beginner: [
                    "Hello, how are you?",
                    "I like to read books.",
                    "The weather is nice today.",
                    "What is your name?",
                    "My favorite color is blue.",
                    "I have a dog and a cat.",
                    "Where do you live?",
                    "I'm learning English.",
                    "What time is it?",
                    "This is delicious food."
                ],
                intermediate: [
                    "The quick brown fox jumps over the lazy dog.",
                    "She sells seashells by the seashore.",
                    "How much wood would a woodchuck chuck if a woodchuck could chuck wood?",
                    "I need to improve my pronunciation skills.",
                    "The government announced new environmental policies.",
                    "Technology has transformed communication methods.",
                    "Education provides opportunities for personal development.",
                    "The organization focuses on international cooperation.",
                    "Professional relationships require effective communication.",
                    "The temperature varies significantly between seasons."
                ],
                advanced: [
                    "The phenomenon was an exquisite example of serendipity.",
                    "His magnanimous gesture was appreciated by everyone present.",
                    "The politician's speech was full of obfuscation and ambiguity.",
                    "The scientist's research paradigm shifted after the new discovery.",
                    "The ubiquitous nature of social media affects modern communication.",
                    "The idiosyncrasy of his pronunciation made him difficult to understand.",
                    "The vociferous debate continued late into the night.",
                    "Her supercilious attitude alienated potential collaborators.",
                    "The quintessential elements of the theory were difficult to grasp.",
                    "Antidisestablishmentarianism represents opposition to the withdrawal of state support from a church."
                ]
            };
            
            // Custom words and sentences storage
            const customItems = {
                beginner: { words: [], sentences: [] },
                intermediate: { words: [], sentences: [] },
                advanced: { words: [], sentences: [] }
            };
            
            // Load custom items from localStorage if available
            function loadCustomItems() {
                const savedItems = localStorage.getItem('pronunciationCustomItems');
                if (savedItems) {
                    const parsedItems = JSON.parse(savedItems);
                    Object.assign(customItems, parsedItems);
                    updateCustomList();
                }
            }
            
            // Save custom items to localStorage
            function saveCustomItems() {
                localStorage.setItem('pronunciationCustomItems', JSON.stringify(customItems));
            }
            
            // Update custom list display
            function updateCustomList() {
                let selectedLevel = 'beginner';
                for (const radio of levelRadios) {
                    if (radio.checked) {
                        selectedLevel = radio.value;
                        break;
                    }
                }
                
                let selectedType = 'word';
                for (const radio of typeRadios) {
                    if (radio.checked) {
                        selectedType = radio.value;
                        break;
                    }
                }
                
                const items = selectedType === 'word' 
                    ? customItems[selectedLevel].words 
                    : customItems[selectedLevel].sentences;
                
                if (items.length === 0) {
                    customList.innerHTML = '<p>No custom items added yet</p>';
                    return;
                }
                
                customList.innerHTML = '';
                items.forEach((item, index) => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'custom-item';
                    itemEl.innerHTML = `
                        <span>${item}</span>
                        <button data-index="${index}">Delete</button>
                    `;
                    customList.appendChild(itemEl);
                });
                
                // Add event listeners to delete buttons
                const deleteButtons = customList.querySelectorAll('button');
                deleteButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        if (selectedType === 'word') {
                            customItems[selectedLevel].words.splice(index, 1);
                        } else {
                            customItems[selectedLevel].sentences.splice(index, 1);
                        }
                        saveCustomItems();
                        updateCustomList();
                    });
                });
            }
            
            // Toggle settings panel
            settingsToggle.addEventListener('click', function() {
                settingsContent.classList.toggle('active');
                const icon = settingsToggle.querySelector('i');
                if (settingsContent.classList.contains('active')) {
                    icon.className = 'fas fa-chevron-up';
                    updateCustomList(); // Update list when opening settings
                } else {
                    icon.className = 'fas fa-chevron-down';
                }
            });
            
            // Add custom item
            addCustomBtn.addEventListener('click', function() {
                const customText = customInput.value.trim();
                if (customText === '') return;
                
                let selectedLevel = 'beginner';
                for (const radio of levelRadios) {
                    if (radio.checked) {
                        selectedLevel = radio.value;
                        break;
                    }
                }
                
                let selectedType = 'word';
                for (const radio of typeRadios) {
                    if (radio.checked) {
                        selectedType = radio.value;
                        break;
                    }
                }
                
                if (selectedType === 'word') {
                    customItems[selectedLevel].words.push(customText);
                } else {
                    customItems[selectedLevel].sentences.push(customText);
                }
                
                saveCustomItems();
                updateCustomList();
                customInput.value = '';
                
                statusEl.textContent = `"${customText}" added to ${selectedLevel} ${selectedType} list`;
            });
            
            // Update custom list when level or type changes
            levelRadios.forEach(radio => {
                radio.addEventListener('change', updateCustomList);
            });
            
            typeRadios.forEach(radio => {
                radio.addEventListener('change', updateCustomList);
            });
            
            // Check if browser supports Web Speech API
            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    checkPronunciation(transcript);
                };
                
                recognition.onend = function() {
                    isRecording = false;
                    recordBtn.classList.remove('recording');
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error', event.error);
                    isRecording = false;
                    recordBtn.classList.remove('recording');
                    statusEl.textContent = "Error: " + event.error;
                };
            } else {
                alert("Speech recognition is not supported in this browser. Try Chrome or Edge.");
                recordBtn.disabled = true;
            }
            
            // Function to speak the text using text-to-speech
            function speakText(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9; // Slightly slower for better clarity
                    
                    // Set a specific voice if available
                    const voices = speechSynthesis.getVoices();
                    const englishVoice = voices.find(voice => 
                        voice.lang.includes('en') && voice.localService === false
                    );
                    
                    if (englishVoice) {
                        utterance.voice = englishVoice;
                    }
                    
                    speechSynthesis.speak(utterance);
                } else {
                    alert("Text-to-speech is not supported in this browser.");
                }
            }
            
            // Event listener for the speak button
            speakBtn.addEventListener('click', function() {
                if (currentText) {
                    speakText(currentText);
                }
            });
            
            startBtn.addEventListener('click', function() {
                // Get selected level and type
                let selectedLevel = 'beginner';
                let selectedType = 'word';
                
                for (const radio of levelRadios) {
                    if (radio.checked) {
                        selectedLevel = radio.value;
                        break;
                    }
                }
                
                for (const radio of typeRadios) {
                    if (radio.checked) {
                        selectedType = radio.value;
                        break;
                    }
                }
                
                // Combine default bank with custom items
                let bank = [];
                if (selectedType === 'word') {
                    bank = [...wordBanks[selectedLevel], ...customItems[selectedLevel].words];
                } else {
                    bank = [...sentenceBanks[selectedLevel], ...customItems[selectedLevel].sentences];
                }
                
                // If no items available, show message
                if (bank.length === 0) {
                    textDisplay.textContent = "No items available for this level and type";
                    statusEl.textContent = "Add some words or sentences in the settings";
                    return;
                }
                
                // Get a random word or sentence based on selection
                const randomIndex = Math.floor(Math.random() * bank.length);
                currentText = bank[randomIndex];
                
                // Display the text
                textDisplay.textContent = currentText;
                
                // Show record and speak buttons
                recordBtn.style.display = 'flex';
                speakBtn.style.display = 'flex';
                startBtn.style.display = 'none';
                
                // Reset accuracy
                accuracyValue.textContent = '0%';
                accuracyValue.style.color = '#333';
                resultDiv.style.display = 'none';
                
                statusEl.textContent = "Click the microphone button and read the text aloud";
            });
            
            recordBtn.addEventListener('click', function() {
                if (!isRecording) {
                    recognition.start();
                    isRecording = true;
                    recordBtn.classList.add('recording');
                    statusEl.textContent = "Recording... Speak now";
                } else {
                    // Stop recording and process immediately
                    recognition.stop();
                    isRecording = false;
                    recordBtn.classList.remove('recording');
                    statusEl.textContent = "Processing your speech...";
                    
                    // Clear any existing timeout
                    if (processingTimeout) {
                        clearTimeout(processingTimeout);
                    }
                    
                    // Force immediate processing (simulate result if API doesn't respond quickly)
                    processingTimeout = setTimeout(() => {
                        statusEl.textContent = "Please try speaking again";
                    }, 1500);
                }
            });
            
            function checkPronunciation(userSpeech) {
                statusEl.textContent = "Checking your pronunciation...";
                
                // Clear processing timeout
                if (processingTimeout) {
                    clearTimeout(processingTimeout);
                }
                
                // Simple algorithm to compare spoken text with target text
                const targetWords = currentText.toLowerCase().replace(/[.,?!]/g, '').split(' ');
                const spokenWords = userSpeech.toLowerCase().replace(/[.,?!]/g, '').split(' ');
                
                let correctCount = 0;
                let resultHTML = '';
                
                // Compare word by word with partial matching
                for (let i = 0; i < targetWords.length; i++) {
                    if (i < spokenWords.length) {
                        if (spokenWords[i] === targetWords[i]) {
                            // Exact match
                            correctCount++;
                            resultHTML += `<span class="correct">${targetWords[i]}</span> `;
                        } else if (isPartialMatch(spokenWords[i], targetWords[i])) {
                            // Partial match
                            correctCount += 0.5;
                            resultHTML += `<span class="partial">${targetWords[i]}</span> `;
                        } else {
                            // No match
                            resultHTML += `<span class="incorrect">${targetWords[i]}</span> `;
                        }
                    } else {
                        // Word not spoken
                        resultHTML += `<span class="incorrect">${targetWords[i]}</span> `;
                    }
                }
                
                // Add any extra words that were spoken
                if (spokenWords.length > targetWords.length) {
                    for (let i = targetWords.length; i < spokenWords.length; i++) {
                        resultHTML += `<span class="incorrect">[${spokenWords[i]}]</span> `;
                    }
                }
                
                // Calculate accuracy percentage
                const accuracy = Math.round((correctCount / targetWords.length) * 100);
                
                // Display results
                resultDiv.innerHTML = resultHTML;
                resultDiv.style.display = 'block';
                accuracyValue.textContent = `${accuracy}%`;
                
                // Change accuracy color based on performance
                if (accuracy >= 80) {
                    accuracyValue.style.color = '#4CAF50';
                } else if (accuracy >= 50) {
                    accuracyValue.style.color = '#FF9800';
                } else {
                    accuracyValue.style.color = '#f44336';
                }
                
                statusEl.textContent = "Pronunciation check completed. Click the microphone to try again or Start for a new text.";
                
                // Show start button again
                startBtn.style.display = 'flex';
                
                // Speak the correct pronunciation after a short delay
                setTimeout(() => {
                    speakText(currentText);
                }, 1000);
            }
            
            // Helper function to check for partial matches
            function isPartialMatch(spokenWord, targetWord) {
                // Check if the spoken word is a substring of the target word or vice versa
                if (spokenWord.includes(targetWord) || targetWord.includes(spokenWord)) {
                    return true;
                }
                
                // Check for similar words with small differences
                const minLength = Math.min(spokenWord.length, targetWord.length);
                if (minLength <= 3) return false;
                
                // Count matching characters in order
                let matchCount = 0;
                let spokenIndex = 0;
                
                for (let i = 0; i < targetWord.length && spokenIndex < spokenWord.length; i++) {
                    if (targetWord[i] === spokenWord[spokenIndex]) {
                        matchCount++;
                        spokenIndex++;
                    }
                }
                
                // If most characters match in order, consider it a partial match
                return matchCount >= minLength * 0.7;
            }
            
            // Initialize the app
            loadCustomItems();
            
            // Preload voices for text-to-speech
            if ('speechSynthesis' in window) {
                speechSynthesis.getVoices(); // This helps preload voices
            }
        });
    </script>
</body>
</html>
