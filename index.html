<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Pronunciation Practice with AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 800px;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
        }
        
        p {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .settings-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: left;
        }
        
        .settings-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .settings-toggle h3 {
            color: #555;
            font-size: 1.1rem;
        }
        
        .settings-content {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        
        .options-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .option-group {
            flex: 1;
            min-width: 200px;
        }
        
        .option-group h4 {
            margin-bottom: 10px;
            color: #555;
            font-size: 0.9rem;
            text-align: left;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-start;
        }
        
        .option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .option input {
            accent-color: #6e8efb;
        }
        
        .option label {
            color: #555;
            font-size: 0.9rem;
        }
        
        .text-display {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            line-height: 1.5;
            color: #333;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
            font-weight: 600;
        }
        
        .text-display::before {
            content: '"';
            font-size: 60px;
            position: absolute;
            left: 15px;
            top: 10px;
            color: #e0e0e0;
            font-family: serif;
        }
        
        .accuracy {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .accuracy-value {
            font-size: 32px;
            transition: all 0.3s ease;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #start-btn, #next-btn {
            background: linear-gradient(135deg, #4CAF50, #2E8B57);
            color: white;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }
        
        #record-btn {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
            color: white;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
            display: none;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            justify-content: center;
            padding: 0;
        }
        
        #record-btn.recording {
            background: linear-gradient(135deg, #f44336, #B71C1C);
            animation: pulse 1.5s infinite;
        }
        
        #speak-btn {
            background: linear-gradient(135deg, #9C27B0, #673AB7);
            color: white;
            box-shadow: 0 4px 10px rgba(156, 39, 176, 0.3);
            display: none;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            background-color: #f8f9fa;
            display: none;
            text-align: left;
            line-height: 1.8;
        }
        
        .correct {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .incorrect {
            color: #f44336;
            font-weight: bold;
        }
        
        .partial {
            color: #FF9800;
            font-weight: bold;
        }
        
        .status {
            margin-top: 20px;
            font-style: italic;
            color: #666;
            min-height: 24px;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.4);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(244, 67, 54, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(244, 67, 54, 0);
            }
        }
        
        .mic-icon {
            font-size: 24px;
        }
        
        .progress-container {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .ai-powered {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .options-row {
                flex-direction: column;
                gap: 15px;
            }
            
            button {
                padding: 12px 25px;
            }
            
            .text-display {
                font-size: 22px;
                padding: 20px 20px 20px 40px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>English Pronunciation Practice with AI</h1>
        <p>Select your level and practice type, then click "Start" to begin. Record your pronunciation and get AI-powered feedback!</p>
        
        <div class="settings-panel">
            <div class="settings-toggle">
                <h3>Practice Settings</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="settings-content">
                <div class="options-row">
                    <div class="option-group">
                        <h4>Difficulty Level</h4>
                        <div class="options">
                            <div class="option">
                                <input type="radio" id="beginner" name="level" value="beginner" checked>
                                <label for="beginner">Beginner</label>
                            </div>
                            <div class="option">
                                <input type="radio" id="intermediate" name="level" value="intermediate">
                                <label for="intermediate">Intermediate</label>
                            </div>
                            <div class="option">
                                <input type="radio" id="advanced" name="level" value="advanced">
                                <label for="advanced">Advanced</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <h4>Practice Type</h4>
                        <div class="options">
                            <div class="option">
                                <input type="radio" id="single-word" name="type" value="word" checked>
                                <label for="single-word">Single Words</label>
                            </div>
                            <div class="option">
                                <input type="radio" id="sentences" name="type" value="sentence">
                                <label for="sentences">Sentences</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="progress-container" id="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <div class="accuracy">
            <i class="fas fa-chart-line"></i>
            Accuracy: <span id="accuracy-value" class="accuracy-value">0%</span>
        </div>
        
        <div class="text-display" id="text-display">
            Click the Start button to begin...
        </div>
        
        <div class="buttons">
            <button id="start-btn">
                <i class="fas fa-play"></i>Start
            </button>
            <button id="next-btn" style="display: none;">
                <i class="fas fa-forward"></i>Next
            </button>
            <button id="record-btn">
                <i class="fas fa-microphone mic-icon"></i>
            </button>
            <button id="speak-btn">
                <i class="fas fa-volume-up"></i>Hear Pronunciation
            </button>
        </div>
        
        <div class="result" id="result"></div>
        <div class="status" id="status">Press Start to begin</div>
        <div class="ai-powered">
            <i class="fas fa-robot"></i> Powered by AI Speech Recognition
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startBtn = document.getElementById('start-btn');
            const nextBtn = document.getElementById('next-btn');
            const recordBtn = document.getElementById('record-btn');
            const speakBtn = document.getElementById('speak-btn');
            const textDisplay = document.getElementById('text-display');
            const resultDiv = document.getElementById('result');
            const accuracyValue = document.getElementById('accuracy-value');
            const statusEl = document.getElementById('status');
            const settingsToggle = document.querySelector('.settings-toggle');
            const settingsContent = document.querySelector('.settings-content');
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            
            // Get radio buttons
            const levelRadios = document.querySelectorAll('input[name="level"]');
            const typeRadios = document.querySelectorAll('input[name="type"]');
            
            let recognition;
            let currentText = '';
            let isRecording = false;
            let processingTimeout;
            let canPlaySound = false; // Control when the sound can be played
            
            // Word and sentence banks by difficulty
            const wordBanks = {
                beginner: [
                    "hello", "world", "apple", "house", "water",
                    "computer", "book", "teacher", "student", "friend",
                    "family", "music", "school", "color", "food"
                ],
                intermediate: [
                    "environment", "pronunciation", "technology", "information", "communication",
                    "development", "education", "government", "international", "organization",
                    "opportunity", "experience", "relationship", "professional", "temperature"
                ],
                advanced: [
                    "onomatopoeia", "idiosyncrasy", "paradigm", "epitome", "quintessential",
                    "ambiguous", "ubiquitous", "vociferous", "supercilious", "magnanimous",
                    "obfuscate", "pernicious", "serendipity", "antidisestablishmentarianism", "floccinaucinihilipilification"
                ]
            };
            
            const sentenceBanks = {
                beginner: [
                    "Hello, how are you?",
                    "I like to read books.",
                    "The weather is nice today.",
                    "What is your name?",
                    "My favorite color is blue.",
                    "I have a dog and a cat.",
                    "Where do you live?",
                    "I'm learning English.",
                    "What time is it?",
                    "This is delicious food."
                ],
                intermediate: [
                    "The quick brown fox jumps over the lazy dog.",
                    "She sells seashells by the seashore.",
                    "How much wood would a woodchuck chuck if a woodchuck could chuck wood?",
                    "I need to improve my pronunciation skills.",
                    "The government announced new environmental policies.",
                    "Technology has transformed communication methods.",
                    "Education provides opportunities for personal development.",
                    "The organization focuses on international cooperation.",
                    "Professional relationships require effective communication.",
                    "The temperature varies significantly between seasons."
                ],
                advanced: [
                    "The phenomenon was an exquisite example of serendipity.",
                    "His magnanimous gesture was appreciated by everyone present.",
                    "The politician's speech was full of obfuscation and ambiguity.",
                    "The scientist's research paradigm shifted after the new discovery.",
                    "The ubiquitous nature of social media affects modern communication.",
                    "The idiosyncrasy of his pronunciation made him difficult to understand.",
                    "The vociferous debate continued late into the night.",
                    "Her supercilious attitude alienated potential collaborators.",
                    "The quintessential elements of the theory were difficult to grasp.",
                    "Antidisestablishmentarianism represents opposition to the withdrawal of state support from a church."
                ]
            };
            
            // Toggle settings panel
            settingsToggle.addEventListener('click', function() {
                settingsContent.classList.toggle('active');
                const icon = settingsToggle.querySelector('i');
                if (settingsContent.classList.contains('active')) {
                    icon.className = 'fas fa-chevron-up';
                } else {
                    icon.className = 'fas fa-chevron-down';
                }
            });
            
            // Initialize speech recognition
            function initSpeechRecognition() {
                if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                    recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    recognition.lang = 'en-US';
                    
                    recognition.onresult = function(event) {
                        const transcript = event.results[0][0].transcript;
                        checkPronunciation(transcript);
                    };
                    
                    recognition.onend = function() {
                        isRecording = false;
                        recordBtn.classList.remove('recording');
                        updateProgressBar(0);
                    };
                    
                    recognition.onerror = function(event) {
                        console.error('Speech recognition error', event.error);
                        isRecording = false;
                        recordBtn.classList.remove('recording');
                        statusEl.textContent = "Error: " + event.error;
                        updateProgressBar(0);
                    };
                } else {
                    alert("Speech recognition is not supported in this browser. Try Chrome or Edge.");
                    recordBtn.disabled = true;
                }
            }
            
            // Function to update progress bar
            function updateProgressBar(percentage) {
                if (percentage > 0) {
                    progressContainer.style.display = 'block';
                    progressBar.style.width = percentage + '%';
                } else {
                    progressContainer.style.display = 'none';
                }
            }
            
            // Function to speak the text using text-to-speech
            function speakText(text) {
                if (!canPlaySound) return;
                
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9; // Slightly slower for better clarity
                    
                    // Set a specific voice if available
                    const voices = speechSynthesis.getVoices();
                    const englishVoice = voices.find(voice => 
                        voice.lang.includes('en') && voice.localService === false
                    );
                    
                    if (englishVoice) {
                        utterance.voice = englishVoice;
                    }
                    
                    speechSynthesis.speak(utterance);
                } else {
                    alert("Text-to-speech is not supported in this browser.");
                }
            }
            
            // Event listener for the speak button
            speakBtn.addEventListener('click', function() {
                if (currentText) {
                    speakText(currentText);
                }
            });
            
            startBtn.addEventListener('click', function() {
                startPractice();
            });
            
            nextBtn.addEventListener('click', function() {
                startPractice();
            });
            
            function startPractice() {
                // Get selected level and type
                let selectedLevel = 'beginner';
                let selectedType = 'word';
                
                for (const radio of levelRadios) {
                    if (radio.checked) {
                        selectedLevel = radio.value;
                        break;
                    }
                }
                
                for (const radio of typeRadios) {
                    if (radio.checked) {
                        selectedType = radio.value;
                        break;
                    }
                }
                
                // Get the appropriate bank
                let bank = selectedType === 'word' ? wordBanks[selectedLevel] : sentenceBanks[selectedLevel];
                
                // Get a random word or sentence based on selection
                const randomIndex = Math.floor(Math.random() * bank.length);
                currentText = bank[randomIndex];
                
                // Display the text
                textDisplay.textContent = currentText;
                
                // Show record button and hide start button
                recordBtn.style.display = 'flex';
                speakBtn.style.display = 'flex';
                startBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                
                // Reset accuracy
                accuracyValue.textContent = '0%';
                accuracyValue.style.color = '#333';
                resultDiv.style.display = 'none';
                
                // Don't allow sound until after user has recorded
                canPlaySound = false;
                
                statusEl.textContent = "Click the microphone button and read the text aloud";
            }
            
            recordBtn.addEventListener('click', function() {
                if (!isRecording) {
                    recognition.start();
                    isRecording = true;
                    recordBtn.classList.add('recording');
                    statusEl.textContent = "Recording... Speak now";
                    
                    // Show progress bar with animation
                    updateProgressBar(30);
                } else {
                    // Stop recording and process immediately
                    recognition.stop();
                    isRecording = false;
                    recordBtn.classList.remove('recording');
                    statusEl.textContent = "Processing your speech...";
                    updateProgressBar(70);
                    
                    // Clear any existing timeout
                    if (processingTimeout) {
                        clearTimeout(processingTimeout);
                    }
                    
                    // Force immediate processing (simulate result if API doesn't respond quickly)
                    processingTimeout = setTimeout(() => {
                        statusEl.textContent = "Please try speaking again";
                        updateProgressBar(0);
                    }, 3000);
                }
            });
            
            function checkPronunciation(userSpeech) {
                statusEl.textContent = "AI is analyzing your pronunciation...";
                updateProgressBar(90);
                
                // Clear processing timeout
                if (processingTimeout) {
                    clearTimeout(processingTimeout);
                }
                
                // Simple algorithm to compare spoken text with target text
                const targetWords = currentText.toLowerCase().replace(/[.,?!]/g, '').split(' ');
                const spokenWords = userSpeech.toLowerCase().replace(/[.,?!]/g, '').split(' ');
                
                let correctCount = 0;
                let resultHTML = '';
                
                // Compare word by word with partial matching
                for (let i = 0; i < targetWords.length; i++) {
                    if (i < spokenWords.length) {
                        if (spokenWords[i] === targetWords[i]) {
                            // Exact match
                            correctCount++;
                            resultHTML += `<span class="correct">${targetWords[i]}</span> `;
                        } else if (isPartialMatch(spokenWords[i], targetWords[i])) {
                            // Partial match
                            correctCount += 0.5;
                            resultHTML += `<span class="partial">${targetWords[i]}</span> `;
                        } else {
                            // No match
                            resultHTML += `<span class="incorrect">${targetWords[i]}</span> `;
                        }
                    } else {
                        // Word not spoken
                        resultHTML += `<span class="incorrect">${targetWords[i]}</span> `;
                    }
                }
                
                // Add any extra words that were spoken
                if (spokenWords.length > targetWords.length) {
                    for (let i = targetWords.length; i < spokenWords.length; i++) {
                        resultHTML += `<span class="incorrect">[${spokenWords[i]}]</span> `;
                    }
                }
                
                // Calculate accuracy percentage
                const accuracy = Math.round((correctCount / targetWords.length) * 100);
                
                // Display results
                resultDiv.innerHTML = resultHTML;
                resultDiv.style.display = 'block';
                accuracyValue.textContent = `${accuracy}%`;
                
                // Change accuracy color based on performance
                if (accuracy >= 80) {
                    accuracyValue.style.color = '#4CAF50';
                    statusEl.textContent = "Excellent pronunciation!";
                } else if (accuracy >= 50) {
                    accuracyValue.style.color = '#FF9800';
                    statusEl.textContent = "Good effort! Keep practicing.";
                } else {
                    accuracyValue.style.color = '#f44336';
                    statusEl.textContent = "Try again and focus on each word.";
                }
                
                // Show next button instead of start button
                nextBtn.style.display = 'flex';
                recordBtn.style.display = 'none';
                
                // Allow sound to be played now
                canPlaySound = true;
                
                // Complete progress bar
                updateProgressBar(100);
                
                // Hide progress bar after a delay
                setTimeout(() => {
                    updateProgressBar(0);
                }, 1000);
            }
            
            // Helper function to check for partial matches
            function isPartialMatch(spokenWord, targetWord) {
                // Check if the spoken word is a substring of the target word or vice versa
                if (spokenWord.includes(targetWord) || targetWord.includes(spokenWord)) {
                    return true;
                }
                
                // Check for similar words with small differences
                const minLength = Math.min(spokenWord.length, targetWord.length);
                if (minLength <= 3) return false;
                
                // Count matching characters in order
                let matchCount = 0;
                let spokenIndex = 0;
                
                for (let i = 0; i < targetWord.length && spokenIndex < spokenWord.length; i++) {
                    if (targetWord[i] === spokenWord[spokenIndex]) {
                        matchCount++;
                        spokenIndex++;
                    }
                }
                
                // If most characters match in order, consider it a partial match
                return matchCount >= minLength * 0.7;
            }
            
            // Enhanced pronunciation analysis using phonetic comparison
            function enhancedPronunciationCheck(userSpeech) {
                // This is a simplified version - a real implementation would use
                // a phonetic algorithm or API for more accurate comparison
                
                const target = currentText.toLowerCase();
                const spoken = userSpeech.toLowerCase();
                
                // Simple comparison first
                if (target === spoken) {
                    return { accuracy: 100, feedback: "Perfect pronunciation!" };
                }
                
                // Calculate Levenshtein distance for similarity
                const distance = levenshteinDistance(target, spoken);
                const maxLength = Math.max(target.length, spoken.length);
                const similarity = (1 - distance / maxLength) * 100;
                
                // Generate feedback based on similarity
                let feedback = "";
                if (similarity >= 90) {
                    feedback = "Very good! Almost perfect.";
                } else if (similarity >= 70) {
                    feedback = "Good effort. Pay attention to a few sounds.";
                } else if (similarity >= 50) {
                    feedback = "Keep practicing. Focus on the pronunciation.";
                } else {
                    feedback = "Try again. Listen to the correct pronunciation first.";
                }
                
                return { 
                    accuracy: Math.round(similarity), 
                    feedback: feedback 
                };
            }
            
            // Levenshtein distance algorithm for string similarity
            function levenshteinDistance(a, b) {
                const matrix = [];
                
                for (let i = 0; i <= b.length; i++) {
                    matrix[i] = [i];
                }
                
                for (let j = 0; j <= a.length; j++) {
                    matrix[0][j] = j;
                }
                
                for (let i = 1; i <= b.length; i++) {
                    for (let j = 1; j <= a.length; j++) {
                        if (b.charAt(i - 1) === a.charAt(j - 1)) {
                            matrix[i][j] = matrix[i - 1][j - 1];
                        } else {
                            matrix[i][j] = Math.min(
                                matrix[i - 1][j - 1] + 1, // substitution
                                Math.min(
                                    matrix[i][j - 1] + 1, // insertion
                                    matrix[i - 1][j] + 1  // deletion
                                )
                            );
                        }
                    }
                }
                
                return matrix[b.length][a.length];
            }
            
            // Preload voices for text-to-speech
            if ('speechSynthesis' in window) {
                speechSynthesis.getVoices(); // This helps preload voices
            }
            
            // Initialize speech recognition when page loads
            initSpeechRecognition();
        });
    </script>
</body>
</html>
